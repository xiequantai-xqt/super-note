# sshè¿æ¥æœåŠ¡å™¨

## è¿æ¥æœåŠ¡å™¨

```sh
# @å‰é¢çš„æ˜¯è´¦æˆ·ï¼Œåé¢çš„æ˜¯å…¬ç½‘åœ°å€
ssh root@47.120.28.21
```

## æ–­å¼€ssh è¿æ¥

```sh
logout
# æˆ–è€…
exit
```

# ä½¿ç”¨screenéƒ¨ç½²

ä½¿ç”¨æ­¥éª¤ï¼š

1. å®‰è£… `screen` æˆ– `tmux`ï¼ˆå¦‚æœè¿˜æ²¡æœ‰å®‰è£…çš„è¯ï¼‰ã€‚
2. ä½¿ç”¨ `screen` æˆ– `tmux` åˆ›å»ºä¸€ä¸ªæ–°çš„ä¼šè¯ï¼Œåœ¨è¿™ä¸ªä¼šè¯ä¸­å¯åŠ¨æ‚¨çš„é¡¹ç›®ã€‚
3. å½“æ‚¨å®Œæˆå·¥ä½œæ—¶ï¼Œæ‚¨å¯ä»¥ä»ä¼šè¯ä¸­å®‰å…¨åœ°é€€å‡ºè€Œä¸ä¼šä¸­æ–­æ­£åœ¨è¿è¡Œçš„ä»»åŠ¡ã€‚

ç¤ºä¾‹æ­¥éª¤ï¼š

> ubuntu

```sh
# å®‰è£… screen
sudo apt-get install screen
# è¿›å…¥ä¸€ä¸ªæ–° session
screen
# åœ¨ screen session ä¸­è¿è¡Œæ‚¨çš„é¡¹ç›®
python myproject.py
# è¦ä» screen session ä¸­é€€å‡ºä½†ä¿æŒ session è¿è¡Œï¼Œè¯·æŒ‰ A æ§åˆ¶é”® (é€šå¸¸æ˜¯ Ctrl+A)ï¼Œç„¶åæŒ‰ D é”® "detach" session
Ctrl+A
D
# æ‚¨å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤é‡æ–°è¿æ¥åˆ° session
screen -r
```

å…¶ä»–ï¼š

1. æ£€æŸ¥screenæ˜¯å¦è¢«å®‰è£…

```sh
screen --version
# æˆ–è€…
screen -v
```

2. å¯åŠ¨ä¼šè¯

```sh
screen
```

3. åˆ›å»ºæ–°çš„ screen ä¼šè¯

> å¦‚æœæ‚¨æƒ³è¦ç»™ `screen` ä¼šè¯å‘½åä»¥ä¾¿æ›´å®¹æ˜“è¯†åˆ«ï¼Œå¯ä»¥è¿™æ ·åš

```sh
screen -S mysessionname
```

4. æ£€æŸ¥ screen çš„è¾“å‡º

> å¦‚æœæ‚¨åœ¨ screen ä¼šè¯ä¸­è¿è¡Œäº†ç¨‹åºï¼Œå¯ä»¥æ£€æŸ¥æ˜¯å¦æœ‰è¾“å‡ºä¿¡æ¯ã€‚æ‚¨ä¹Ÿå¯ä»¥åœ¨é€€å‡º screen ä¼šè¯åæŸ¥çœ‹è¾“å‡º

```sh
screen -ls    # åˆ—å‡ºæ‰€æœ‰çš„ screen ä¼šè¯
screen -r     # é‡æ–°é™„åŠ åˆ°æœ€è¿‘çš„ session
screen -r mysessionname  # é‡æ–°é™„åŠ åˆ°æŒ‡å®šåç§°çš„ session
```

5. å¦‚æœ `screen` ä»ç„¶ä¸èµ·ä½œç”¨ï¼Œæ‚¨å¯ä»¥è€ƒè™‘ä½¿ç”¨ `tmux`ï¼Œå®ƒæ˜¯ä¸€ä¸ªç±»ä¼¼çš„ç»ˆç«¯å¤ç”¨å™¨ã€‚æ‚¨å¯ä»¥å®‰è£…å¹¶ä½¿ç”¨ `tmux`

```sh
sudo apt-get install tmux
tmux
```

6. screenæ–­æ‰æ‰€æœ‰æœåŠ¡

```sh
pkill screen
```

7. å¸è½½screen

```sh
# ä½¿ç”¨ apt å‘½ä»¤å¸è½½ screen åŠå…¶ä¾èµ–é¡¹
sudo apt remove --purge screen

# æ¸…ç†æ®‹ç•™ä¾èµ–ï¼ˆå¯é€‰ï¼‰
sudo apt autoremove

# æ£€æŸ¥ screen æ˜¯å¦å·²å®Œå…¨å¸è½½,å¦‚æœè¾“å‡ºä¸ºç©ºï¼Œè¯´æ˜å¸è½½æˆåŠŸã€‚
which screen
```

# ä½¿ç”¨nginxéƒ¨ç½²

---

## 1. å‡†å¤‡å·¥ä½œ
#### **1.1 æœ¬åœ°æ‰“åŒ…é¡¹ç›®**
åœ¨æœ¬åœ°å¼€å‘ç¯å¢ƒä¸­å®Œæˆä»¥ä¸‹æ“ä½œï¼š
1. **è¿›å…¥é¡¹ç›®ç›®å½•**ï¼š
   
   ```bash
   cd private-super-system
   ```
2. **å®‰è£…ä¾èµ–å¹¶æ‰“åŒ…**ï¼š
   
   ```bash
   npm install
   npm run build
   ```
   æˆ–è€…ä½¿ç”¨ `yarn`ï¼š
   ```bash
   yarn install
   yarn build
   ```
   æ‰“åŒ…å®Œæˆåï¼Œä¼šåœ¨é¡¹ç›®æ ¹ç›®å½•ç”Ÿæˆä¸€ä¸ª `dist` æ–‡ä»¶å¤¹ï¼ˆåŒ…å«æ‰€æœ‰é™æ€æ–‡ä»¶ï¼‰ã€‚

---

#### **1.2 ä¸Šä¼ æ–‡ä»¶åˆ°æœåŠ¡å™¨**
å°† `dist` æ–‡ä»¶å¤¹ä¸Šä¼ åˆ°é˜¿é‡Œäº‘ Ubuntu æœåŠ¡å™¨ï¼š
- **æ–¹æ³•ä¸€ï¼šä½¿ç”¨ FTP å·¥å…·ï¼ˆæ¨èæ–°æ‰‹ï¼‰**
  1. å®‰è£… FTP å·¥å…·ï¼ˆå¦‚ [FileZilla](https://filezilla-project.org/)ï¼‰ã€‚
  2. è¿æ¥åˆ°æœåŠ¡å™¨ï¼ˆè¾“å…¥æœåŠ¡å™¨ IPã€ç«¯å£ 22ã€ç”¨æˆ·åå’Œå¯†ç ï¼‰ã€‚
  3. å°† `dist` æ–‡ä»¶å¤¹ä¸Šä¼ åˆ°æœåŠ¡å™¨çš„ `/var/www/private-super-system` ç›®å½•ï¼ˆå¦‚æœæ²¡æœ‰è¯¥ç›®å½•ï¼Œå¯æ‰‹åŠ¨åˆ›å»ºï¼‰ã€‚

- **æ–¹æ³•äºŒï¼šä½¿ç”¨ SCP å‘½ä»¤**
  ```bash
  scp -r dist username@your_server_ip:/var/www/private-super-system
  ```
  æ›¿æ¢ `username` ä¸ºä½ çš„æœåŠ¡å™¨ç”¨æˆ·åï¼ˆå¦‚ `ubuntu`ï¼‰ï¼Œ`your_server_ip` ä¸ºæœåŠ¡å™¨å…¬ç½‘ IPã€‚

---

## 2. æœåŠ¡å™¨é…ç½®
#### **2.1 å®‰è£… Nginx**
1. **æ›´æ–°ç³»ç»ŸåŒ…åˆ—è¡¨**ï¼š
   ```bash
   sudo apt update
   ```
2. **å®‰è£… Nginx**ï¼š
   ```bash
   sudo apt install nginx
   ```
3. **å¯åŠ¨ Nginx æœåŠ¡**ï¼š
   ```bash
   sudo systemctl start nginx
   ```
4. **è®¾ç½®å¼€æœºè‡ªå¯**ï¼š
   ```bash
   sudo systemctl enable nginx
   ```

#### **2.2 é…ç½®é˜²ç«å¢™**
1. **æ£€æŸ¥é˜²ç«å¢™çŠ¶æ€**ï¼š
   ```bash
   sudo ufw status
   ```
   å¦‚æœæœªå¯ç”¨ï¼Œæ‰§è¡Œï¼š
   ```bash
   sudo ufw enable
   ```
2. **å¼€æ”¾ HTTP å’Œ HTTPS ç«¯å£**ï¼š
   ```bash
   sudo ufw allow 'Nginx Full'
   ```

#### **2.3 é…ç½® Nginx**
1. **åˆ›å»º Nginx é…ç½®æ–‡ä»¶**ï¼š

   ```bash
   # nanoç¼–è¾‘
   sudo nano /etc/nginx/sites-available/private-super-system
   # vimç¼–è¾‘
   sudo vim /etc/nginx/sites-available/private-super-system
   ```
   å°†ä»¥ä¸‹å†…å®¹ç²˜è´´åˆ°æ–‡ä»¶ä¸­ï¼ˆæ ¹æ®å®é™…è·¯å¾„ä¿®æ”¹ï¼‰ï¼š
   ```nginx
   server {
       listen 8000;
       server_name 47.120.28.21;
       
       root /var/www/private-super-system/dist;
       index index.html;
   
       location / {
           try_files $uri $uri/ /index.html;
       }
   
       # é™æ€æ–‡ä»¶ç¼“å­˜
       location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg)$ {
           expires 1y;
           add_header Cache-Control "public, max-age=31536000";
       }
   }
   ```
   
2. **å¯ç”¨é…ç½®æ–‡ä»¶**ï¼š
   
   ```bash
   sudo ln -s /etc/nginx/sites-available/private-super-system /etc/nginx/sites-enabled/
   ```
   
   æŠ¥é”™ï¼š
   
   > æˆ‘çš„OSSé“¾æ¥ï¼šhttps://it-mystudy.oss-cn-guangzhou.aliyuncs.com/28f2788d-f949-44a3-8a11-7ea499da8da2.png
   
   ![](https://educt-files.oss-cn-shenzhen.aliyuncs.com/9061198a-6cea-4378-80ae-df91befe8660.png)
   
   è§£å†³ï¼š
   
   1. å¼ºåˆ¶è¦†ç›–ç°æœ‰é“¾æ¥
   
   > ç›´æ¥ä½¿ç”¨ -f é€‰é¡¹å¼ºåˆ¶è¦†ç›–ï¼š
   
   ```sh
   sudo ln -sf /etc/nginx/sites-available/private-super-system /etc/nginx/sites-enabled/
   ```
   
   è§£é‡Šï¼š
   
   - -fï¼šå¼ºåˆ¶åˆ é™¤å·²å­˜åœ¨çš„åŒåæ–‡ä»¶æˆ–é“¾æ¥ã€‚
   - -sï¼šåˆ›å»ºç¬¦å·é“¾æ¥ã€‚
   
3. **æµ‹è¯• Nginx é…ç½®**ï¼š

   ```bash
   sudo nginx -t
   ```
   å¦‚æœæç¤º `syntax is ok`ï¼Œåˆ™é…ç½®æ­£ç¡®ã€‚

4. **é‡å¯ Nginx æœåŠ¡**ï¼š
   ```bash
   sudo systemctl restart nginx
   ```

---

## 3. éªŒè¯éƒ¨ç½²
1. **é€šè¿‡æµè§ˆå™¨è®¿é—®**ï¼š
   åœ¨æµè§ˆå™¨ä¸­è¾“å…¥æœåŠ¡å™¨å…¬ç½‘ IP æˆ–ç»‘å®šçš„åŸŸåï¼Œä¾‹å¦‚ï¼š
   ```
   http://47.120.28.21:8000
   ```
   å¦‚æœçœ‹åˆ°é¡¹ç›®é¦–é¡µï¼Œè¯´æ˜éƒ¨ç½²æˆåŠŸï¼Œçœ‹ä¸åˆ°å…ˆæŒ‰ctrl+F5å¼ºåˆ¶åˆ·æ–°ã€‚

2. **å¸¸è§é—®é¢˜æ’æŸ¥**ï¼š
   
   - **403 Forbidden**ï¼šæ£€æŸ¥ `/var/www/private-super-system` ç›®å½•çš„æƒé™ã€‚
     ```bash
     sudo chmod -R 755 /var/www/private-super-system
     sudo chown -R www-data:www-data /var/www/private-super-system
     ```
   - **502 Bad Gateway**ï¼šæ£€æŸ¥ Nginx é…ç½®æ˜¯å¦æœ‰è¯­æ³•é”™è¯¯ï¼Œæˆ–æŸ¥çœ‹æ—¥å¿—ï¼š
     
     ```bash
     sudo tail -f /var/log/nginx/error.log
     ```

## 4.é‡åˆ°çš„é—®é¢˜

### ä¸ºä»€ä¹ˆæˆ‘ç”¨æµè§ˆå™¨è®¿é—® â€œhttp://47.120.28.21â€ çš„æ—¶å€™ï¼Œå±•ç¤ºçš„æ˜¯nginxé»˜è®¤é¡µé¢ï¼Œè€Œä¸æ˜¯æˆ‘çš„é¡¹ç›®é¦–é¡µï¼Ÿ

---

ğŸ” é€æ­¥æ’æŸ¥æµç¨‹ï¼ˆè¯·åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼‰

#### 1. æ£€æŸ¥Nginxé…ç½®æ˜¯å¦ç”Ÿæ•ˆ

```bash
# æŸ¥çœ‹å·²å¯ç”¨çš„ç«™ç‚¹é…ç½®
ls -l /etc/nginx/sites-enabled

# æŸ¥çœ‹é…ç½®æ–‡ä»¶å†…å®¹ï¼ˆç¡®è®¤rootè·¯å¾„æŒ‡å‘ä½ çš„é¡¹ç›®ï¼‰
cat /etc/nginx/sites-available/private-super-system
```
âœ… **åº”æœ‰è¾“å‡º**ï¼š  
- `sites-enabled` ç›®å½•ä¸­å­˜åœ¨ `private-super-system` çš„è½¯é“¾æ¥  
- é…ç½®æ–‡ä»¶ä¸­ `root` è·¯å¾„åº”ä¸º `/var/www/private-super-system/dist`

#### 2. æ£€æŸ¥é»˜è®¤é…ç½®å¹²æ‰°
```bash
# æŸ¥çœ‹é»˜è®¤é…ç½®æ˜¯å¦ä»å­˜åœ¨
ls /etc/nginx/sites-enabled/default

# å¦‚æœå­˜åœ¨åˆ™åˆ é™¤é»˜è®¤é…ç½®
sudo rm /etc/nginx/sites-enabled/default
sudo systemctl restart nginx
```

#### 3. éªŒè¯æ–‡ä»¶è·¯å¾„
```bash
# ç¡®è®¤distç›®å½•å­˜åœ¨
ls -l /var/www/private-super-system/dist

# æ£€æŸ¥index.htmlæ˜¯å¦å­˜åœ¨
ls /var/www/private-super-system/dist/index.html
```
âœ… **åº”æœ‰è¾“å‡º**ï¼šèƒ½çœ‹åˆ°å®Œæ•´çš„æ„å»ºæ–‡ä»¶åˆ—è¡¨

#### 4. æŸ¥çœ‹Nginxå®é™…åŠ è½½çš„é…ç½®
```bash
sudo nginx -T | grep "server_name\|root"
```
âœ… **åº”æœ‰è¾“å‡º**ï¼šæ˜¾ç¤ºä½ çš„æœåŠ¡å™¨IPå’Œæ­£ç¡®çš„é¡¹ç›®è·¯å¾„

#### 5. æƒé™æ£€æŸ¥
```bash
# æŸ¥çœ‹ç›®å½•æƒé™
ls -ld /var/www/private-super-system

# ä¿®æ­£æƒé™ï¼ˆå¦‚æœæƒé™ä¸è¶³ï¼‰
sudo chown -R www-data:www-data /var/www/private-super-system
sudo chmod -R 755 /var/www
```

#### 6. æŸ¥çœ‹ç«¯å£å ç”¨
```bash
sudo netstat -tulpn | grep :80
```
âœ… **åº”æœ‰è¾“å‡º**ï¼š`nginx` è¿›ç¨‹æ­£åœ¨ç›‘å¬80ç«¯å£

---

### ğŸš¨ å¸¸è§é—®é¢˜é”å®š
æ ¹æ®ç»éªŒï¼Œä½ çš„æƒ…å†µ **90%** å¯èƒ½ç”±ä»¥ä¸‹åŸå› å¯¼è‡´ï¼š
1. **æœªåˆ é™¤é»˜è®¤é…ç½®**ï¼šNginxé»˜è®¤ä¼šåŠ è½½ `/etc/nginx/sites-enabled/default`ï¼Œè¿™ä¸ªé…ç½®ä¼˜å…ˆäºä½ çš„è‡ªå®šä¹‰é…ç½®
2. **è·¯å¾„é”™è¯¯**ï¼šé…ç½®æ–‡ä»¶ä¸­ `root` è·¯å¾„å¯èƒ½å¤šå†™äº† `/dist` æˆ–å°‘å†™äº†ç›®å½•å±‚çº§
3. **æœªé‡å¯Nginx**ï¼šä¿®æ”¹é…ç½®åå¿˜è®°æ‰§è¡Œ `sudo systemctl restart nginx`

---

### ğŸ”§ å¿«é€Ÿä¿®å¤æ–¹æ¡ˆ
```bash
# 1. ç¦ç”¨é»˜è®¤é…ç½®
sudo rm -f /etc/nginx/sites-enabled/default

# 2. ç¡®è®¤é¡¹ç›®é…ç½®
sudo nano /etc/nginx/sites-available/private-super-system
# æ£€æŸ¥ä»¥ä¸‹å…³é”®ç‚¹ï¼š
#   root /var/www/private-super-system/dist;
#   server_name 47.120.28.21; 

# 3. å¼ºåˆ¶åˆ·æ–°Nginx
sudo systemctl stop nginx
sudo systemctl start nginx

# 4. æŸ¥çœ‹å®æ—¶æ—¥å¿—ï¼ˆæ–°å¼€ä¸€ä¸ªSSHçª—å£ï¼‰
tail -f /var/log/nginx/access.log /var/log/nginx/error.log
```
ç°åœ¨ç«‹å³åˆ·æ–°æµè§ˆå™¨ï¼Œåº”è¯¥å¯ä»¥çœ‹åˆ°ä½ çš„é¡¹ç›®é¡µé¢äº†ã€‚å¦‚æœä»æœ‰é—®é¢˜ï¼Œè¯·å°†æ‰§è¡Œä»¥ä¸Šå‘½ä»¤åçš„å®Œæ•´ç»ˆç«¯è¾“å‡ºç²˜è´´ç»™æˆ‘ã€‚
