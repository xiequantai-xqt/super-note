# 闭包

## 一、对闭包的理解？

闭包是JavaScript中的一个重要概念，它涉及到函数和作用域。简单来说，闭包就是一个函数，这个函数可以访问并操作其外部作用域中的变量，即使在其外部函数执行完毕后，这些变量仍然可以被保留和访问。闭包的关键在于它创建了一个持久的作用域链，使得内部函数能够“记住”其诞生时的环境。

闭包的主要特点体现在以下几个方面：

1. **作用域链**：闭包形成了一条作用域链，允许内部函数访问外部函数的局部变量，即使外部函数已经执行完毕，这些变量仍然在内存中存在，因为它们被内部函数引用。
2. **变量生命周期**：由于闭包，外部函数的局部变量不会在外部函数执行完后立即被垃圾回收，它们的生命周期得以延长，直到没有其他引用指向它们。
3. **`this`的绑定**：闭包中的`this`指向在函数定义时确定，而不是调用时，这可以帮助在特定上下文中保持`this`的值，尤其是在异步编程或事件处理中。
4. **应用场景**：
   - **私有变量**：闭包常用于创建私有变量和方法，避免全局污染。
   - **模块化**：通过闭包实现模块化，封装数据和逻辑。
   - **异步编程**：在回调函数、Promise或async/await中，闭包可以帮助保存异步操作的上下文。
   - **事件处理**：在事件监听器中，闭包可以确保事件处理器能够访问外部的变量和状态。

然而，闭包也需要注意内存管理。过度使用闭包可能导致内存泄漏，特别是在循环中创建闭包时。因此，理解何时创建和销毁闭包至关重要，以避免不必要的资源消耗。

总的来说，闭包是JavaScript中实现功能强大且灵活代码的关键工具，但需要谨慎使用，以确保代码的性能和可维护性。

# this关键字

## 一、对this对象的理解？

1. **全局上下文**：
   - 在全局执行环境中（非严格模式下），`this`指向全局对象。在浏览器中，这通常是`window`对象；在Node.js环境中，是`global`对象。
   - 在严格模式（`'use strict';`）下，全局范围内的`this`是`undefined`。
2. **函数调用**：
   - 直接调用一个函数时，非严格模式下`this`同样指向全局对象。在严格模式下，`this`是`undefined`。
   - 如果函数作为对象的方法被调用，`this`指向该对象。
3. **构造函数**：
   - 使用`new`关键字调用构造函数时，`this`指向新创建的实例对象。
4. **箭头函数**：
   - 箭头函数不绑定自己的`this`，它会捕获其所在上下文的`this`值作为自己的`this`值。这意味着箭头函数的`this`由其定义时的环境决定，而非调用时的环境。
5. **call(), apply(), bind()方法**：
   - 这些方法可以显式地设置函数调用时的`this`值。
   - `call()`和`apply()`方法可以立即调用函数，并传入指定的`this`值和参数。
   - `bind()`方法创建一个新的函数，其`this`值被永久绑定到传入的值，但不会立即调用函数。
6. **事件处理器**：
   - 在DOM事件处理程序中，`this`通常指向触发事件的元素，但这也会受到事件绑定方式的影响。
7. **异步编程**：
   - 在Promise链、async/await或回调函数中，`this`的值通常需要特别注意，因为它们的上下文可能与预期不符，可能需要使用`.bind()`、箭头函数或其它技巧来确保正确的`this`值。

## 二、bind、call和apply的区别？

1. 三者都可以改变函数的`this`对象指向
2. 三者第一个参数都是`this`要指向的对象，如果如果没有这个参数或参数为`undefined`或`null`，则默认指向全局`window`
3. 三者都可以传参，但是`apply`是数组，而`call`是参数列表，且`apply`和`call`是一次性传入参数，而`bind`可以分为多次传入
4. `bind`是返回绑定this之后的函数，`apply`、`call` 则是立即执行

# 构造函数

## 一、如果new一个箭头函数的会怎么样？

在JS中，箭头函数与普通函数不同，不会创建自己的this上下文，而是从外围作用域继承this。使用new关键字实例化箭头函数就会抛出一个错误，原因是new关键字期望构造函数创建一个实例对象，并且该函数内部的this应该绑定到新创建对象。但是箭头函数没有属于自己的this，也不支持用作构造函数，因此这种用法是无效的，并且会导致抛出错误。

## 二、new操作符的实现原理？

在JavaScript中，new操作符用来创建一个给定构造函数（通常是函数）的新实例。当使用 new 关键字调用构造函数时，会发生以下步骤：

1. 创建一个新的空对象。
2. 将这个新对象的原型设置为构造函数的原型属性（即 constructor.prototype）。
3. 将构造函数的 this 上下文绑定到这个新的对象。
4. 执行构造函数内的代码（为这个新对象添加属性）。
5. 如果构造函数没有返回其他对象，则 new 操作默认返回这个新的对象。